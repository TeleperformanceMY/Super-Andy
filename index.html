<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat Widget</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  }

  /* Chat Container */
  #chat-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 380px;
    height: 600px;
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s ease;
    background: white;
    display: flex;
    flex-direction: column;
    z-index: 9999;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  /* Minimized State */
  #chat-container.minimized {
    width: 70px;
    height: 70px;
    border-radius: 35px;
    cursor: pointer;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Iframe Container */
  #iframe-wrapper {
    flex-grow: 1;
    background: white;
    position: relative;
    overflow: hidden;
  }

  #chat-container.minimized #iframe-wrapper {
    display: none;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Loading State */
  #loading-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
  }

  #loading-indicator.active {
    display: block;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #D4B5E8;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Chat Icon (Minimized) */
  #chat-icon {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    object-position: center 25%;
  }

  #chat-container:not(.minimized) #chat-icon {
    display: none;
  }

  /* Notification Badge */
  #notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ef4444;
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 11px;
    font-weight: 700;
    display: none;
  }

  #chat-container.minimized #notification-badge.active {
    display: block;
  }

  /* Minimize Button */
  #minimize-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    z-index: 10000;
  }

  #minimize-btn:hover {
    background: rgba(0, 0, 0, 0.1);
  }

  #minimize-btn svg {
    width: 18px;
    height: 18px;
    fill: #666;
  }

  #chat-container.minimized #minimize-btn {
    display: none;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    #chat-container {
      width: 100%;
      height: 100%;
      bottom: 0;
      right: 0;
      border-radius: 0;
    }

    #chat-container.minimized {
      width: 56px;
      height: 56px;
      bottom: 16px;
      right: 16px;
      border-radius: 28px;
    }
  }
</style>
</head>
<body>
<div id="chat-container" class="minimized">
  <!-- Notification Badge -->

  <!-- Minimize Button -->
  <button id="minimize-btn" title="Minimize">
    <svg viewBox="0 0 24 24">
      <path d="M19 13H5v-2h14v2z"/>
    </svg>
  </button>

  <!-- Iframe Wrapper -->
  <div id="iframe-wrapper">
    <div id="loading-indicator" class="active">
      <div class="spinner"></div>
    </div>
    <iframe
      id="chat-iframe"
      src="https://copilotstudio.microsoft.com/environments/d8855a0b-6453-e408-9c94-add3719cb29c/bots/ca_agent/webchat?__version__=2"
      allow="microphone"
    ></iframe>
  </div>
  
  <!-- Chat Icon (visible when minimized) -->
  <img id="chat-icon" src="image.png" alt="Chat Support"/>
</div>

<script>
  const container = document.getElementById('chat-container');
  const minimizeBtn = document.getElementById('minimize-btn');
  const iframe = document.getElementById('chat-iframe');
  const loadingIndicator = document.getElementById('loading-indicator');
  const notificationBadge = document.getElementById('notification-badge');

  // Toggle chat widget
  function toggleChat() {
    container.classList.toggle('minimized');
    if (!container.classList.contains('minimized')) {
      notificationBadge.classList.remove('active');
    }
  }

  // Click on minimized container to expand
  container.addEventListener('click', (e) => {
    if (container.classList.contains('minimized')) {
      e.stopPropagation();
      toggleChat();
    }
  });

  // Minimize button
  minimizeBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleChat();
  });

  // Hide loading indicator when iframe loads
  iframe.addEventListener('load', () => {
    loadingIndicator.classList.remove('active');
  });

  // Simulate notification (remove this in production)
  setTimeout(() => {
    if (container.classList.contains('minimized')) {
      notificationBadge.classList.add('active');
    }
  }, 3000);
</script>
</body>
</html>
